<!DOCTYPE html><html><head><head> <!-- Include Meta Tags Here --><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no"><meta content='#000000' name='theme-color'/><meta name="keywords" content="Site, Blog, Portfolio, CV, Java, Engineer, Developer"><title>Roman Surkoff | The optimal Docker image for Spring Boot. Part 1</title><!-- Open Graph general (Facebook, Pinterest & Google+) --><meta name="og:title" content="Roman Surkoff | The optimal Docker image for Spring Boot. Part 1"><meta name="og:description" content="The article outlines various methods for packaging a Spring Boot application into a Docker container, highlighting best practices and practical implementation steps."><meta name="og:image" content="/assets/images/posts/2024/00007-0.png"><meta name="og:image:alt" content="Roman Surkoff | The optimal Docker image for Spring Boot. Part 1"><meta name="og:url" content="http://localhost:4000/blog/optimal-docker-image-for-springboot-1"><meta name="article:author" content="https://www.facebook.com/"><meta name="og:site_name" content="Roman Surkoff | The optimal Docker image for Spring Boot. Part 1"><meta name="og:type" content="website"> <!-- Twitter --><meta property="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Roman Surkoff | The optimal Docker image for Spring Boot. Part 1"><meta name="twitter:description" content="The article outlines various methods for packaging a Spring Boot application into a Docker container, highlighting best practices and practical implementation steps."><meta name="twitter:site" content="@"><meta name="twitter:creator" content="@"><meta name="twitter:image:src" content="/assets/images/posts/2024/00007-0.png"> <!-- Search Engine --><meta name="description" content="The article outlines various methods for packaging a Spring Boot application into a Docker container, highlighting best practices and practical implementation steps."><meta name="image" content="/assets/images/posts/2024/00007-0.png"> <!-- Schema.org for Google --><meta itemprop="name" content="Roman Surkoff | The optimal Docker image for Spring Boot. Part 1"><meta name="author" content="Roman Surkoff"/><meta itemprop="description" content="The article outlines various methods for packaging a Spring Boot application into a Docker container, highlighting best practices and practical implementation steps."><meta itemprop="image" content="/assets/images/posts/2024/00007-0.png"> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=/"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', '/'); </script><title>Roman Surkoff</title><link rel="stylesheet" href="/assets/css/style.css"> <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script><link rel="shortcut icon" href="http://localhost:4000/assets/images/logo.png" type="image/x-icon"></head></head><body><nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar"><div class="container"> <!-- logo or branding image on left side --><div class="navbar-brand"> <a class="navbar-item" href="http://localhost:4000/"> <strong>Roman Surkoff</strong> </a><div class="navbar-burger" data-target="navbar-menu"> <span></span> <span></span> <span></span></div></div><!-- children of navbar-menu must be navbar-start and/or navbar-end --><div class="navbar-menu has-background-black" id="navbar-menu"> <!-- navbar items | left side --> <!--<div class="navbar-start"></div>--> <!-- navbar items | right side --><div class="navbar-end"> <a class="navbar-item " href="http://localhost:4000/">HOME</a> <a class="navbar-item" href="http://localhost:4000/#summary">SUMMARY</a> <a class="navbar-item" href="http://localhost:4000/#contact">CONTACT</a> <a class="navbar-item " href="http://localhost:4000/blog">BLOG</a><div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link"> MORE </a><div class="navbar-dropdown has-background-black is-left"> <a href="http://localhost:4000/about" class="navbar-item has-text-grey-light "> About me </a> <a href="http://localhost:4000/cv" class="navbar-item has-text-grey-light "> CV </a> <a href="http://localhost:4000/project" class="navbar-item has-text-grey-light "> Projects </a> <!--<hr class="navbar-divider"> <a class="navbar-item"> Report an issue </a> --></div></div></div></div></div></nav><!-- Bulma Navbar JS --> <script> document.addEventListener('DOMContentLoaded', function () { /* Get all "navbar-burger" elements */ var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0); /* Check if there are any navbar burgers */ if ($navbarBurgers.length > 0) { /* Add a click event on each of them */ $navbarBurgers.forEach(function ($el) { $el.addEventListener('click', function () { /* Get the target from the "data-target" attribute */ var target = $el.dataset.target; var $target = document.getElementById(target); /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */ $el.classList.toggle('is-active'); $target.classList.toggle('is-active'); }); }); } }); </script><section class="hero is-fullheight has-text-centered" id="post"><div class="hero-body"><div class="container"> <a href="/blog/optimal-docker-image-for-springboot-1" class="has-text-black" id="title"><h1 class="title has-text-centered is-2 has-text-weight-semibold">The optimal Docker image for Spring Boot. Part 1</h1></a><hr class="has-background-black"><div class="columns is-variable is-5"><div class="column is-6"><figure class="image is-16by9 has-shadow"> <img src="/assets/images/posts/2024/00007-0.png" alt="" id="post-image"></figure></div><div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile"><p id="description" class="content is-small has-text-weight-medium is-uppercase">The article outlines various methods for packaging a Spring Boot application into a Docker container, highlighting best practices and practical implementation steps.</p><p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Published on <b>October 14, 2024</b> by <a href="https://github.com/s-rb" target="_blank"><b class="has-text-link"><u>Roman Surkoff</u></b> </a></p><p class="subtitle is-uppercase"> <i class="fas fa-tags"></i> <span class="tag is-link">springboot</span> <span class="tag is-link">docker</span> <span class="tag is-link">optimization</span> <span class="tag is-link">image</span> <span class="tag is-link">post</span></p><p class="subtitle is-uppercase"><i class="fas fa-clock"></i> <b class="has-text-link"> 6 min </b>READ</p></div></div><div class="content has-text-justified-desktop has-text-justified-fullhd has-text-justified has-text-justified-tablet has-text-left-mobile"><p><p>This article discusses popular methods for packaging a Spring Boot application into a Docker container, emphasizing the importance of optimal packaging to avoid security vulnerabilities. It explores four specific approaches: a simple Dockerfile, building with the spring-boot-maven-plugin, using Googleâ€™s Jib plugin, and writing an optimized Dockerfile. The article also provides practical steps for building and running the application, along with an analysis of the resulting Docker image.</p><hr /><div class="Article-Text"><span><div>Let's consider popular ways to package an application into a container. We'll write our optimal Dockerfile for Spring Boot.</div><div><br /></div><div>We live in the era of microservices architecture, and containers have become the primary means of packaging and delivering applications to various environments. However, many developers do not pay enough attention to how to properly package a service, how to do it optimally, and most importantly, how not to leave security holes. In this article, we will explore 4 packaging methods:</div><div><br /></div><div>- Simple Dockerfile - build and get the image.</div><div>- Building with the spring-boot-maven-plugin.</div><div>- Using the special Jib plugin from Google.</div><div>- Writing an optimized Dockerfile.</div><br /><div>For experiments, we will use the following project: github.com/Example-uPagge/spring_boot_docker. This is a Spring Boot application that contains a couple of simple controllers and repositories with an H2 database.</div><h2>Simple Dockerfile</h2><div>A typical Dockerfile that developers write looks like this:</div><div><br /></div><pre style="font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-stretch: normal; font-size: 12px; line-height: 18px; font-family: Consolas, Monaco, Monospaced, monospace; margin-top: 5px; margin-bottom: 5px; padding: 5px; vertical-align: baseline; border: 1px solid rgb(154, 154, 154); outline: 0px; background-image: none; background-position: 0px 0px; background-repeat: repeat; background-attachment: scroll; background-color: rgb(241, 241, 241); max-width: 100%; overflow: auto; color: rgb(64, 64, 64);"><div>
FROM openjdk:17.0.2-jdk-slim-buster
</div>
<div>ARG JAR_FILE=target/*.jar</div>
<div>COPY ${JAR_FILE} app.jar</div>
<div>ENTRYPOINT ["java","-jar","/app.jar"]</div>
</pre><div><br /></div><div> <img style="height: auto; display: block; margin: auto; max-width: 500px;" src="/assets/images/posts/2024/00007-1.jpg" /> <br /></div><div><br /></div><div>Like a cake, a Docker image consists of a stack of layers. Each represents a change from the previous layer. When we pull a Docker image from the registry, it is pulled layer by layer and cached on the host.</div><div><br /></div><div>Our typical Docker image consists of a base layer with Linux - the thinner, the better. Then comes the JDK layer. And on top is the application layer, which is effectively just a jar file.</div><div><br /></div><div>Spring Boot uses the "Fat JAR" packaging format by default. This means that all dependencies required for execution are added to a single JAR file.</div><div><br /></div><div>But enough theory, let's move on to practice. To obtain the image, first build the application using Maven:</div><div><br /></div><pre style="font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-stretch: normal; font-size: 12px; line-height: 18px; font-family: Consolas, Monaco, Monospaced, monospace; margin-top: 5px; margin-bottom: 5px; padding: 5px; vertical-align: baseline; border: 1px solid rgb(154, 154, 154); outline: 0px; background-image: none; background-position: 0px 0px; background-repeat: repeat; background-attachment: scroll; background-color: rgb(241, 241, 241); max-width: 100%; overflow: auto; color: rgb(64, 64, 64);">mvn clean package</pre><div>Then build the image:</div><div><br /></div><pre style="font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-stretch: normal; font-size: 12px; line-height: 18px; font-family: Consolas, Monaco, Monospaced, monospace; margin-top: 5px; margin-bottom: 5px; padding: 5px; vertical-align: baseline; border: 1px solid rgb(154, 154, 154); outline: 0px; background-image: none; background-position: 0px 0px; background-repeat: repeat; background-attachment: scroll; background-color: rgb(241, 241, 241); max-width: 100%; overflow: auto; color: rgb(64, 64, 64);">docker build -t upagge/spring-boot-docker:dockerfile .</pre><div>In this case, 'upagge' is your DockerHub login, 'spring-boot-docker' is the image name, and 'dockerfile' is the tag. If you do not plan to push the image to DockerHub, you can specify the name without using the login. For example:</div><div><br /></div><pre style="font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-stretch: normal; font-size: 12px; line-height: 18px; font-family: Consolas, Monaco, Monospaced, monospace; margin-top: 5px; margin-bottom: 5px; padding: 5px; vertical-align: baseline; border: 1px solid rgb(154, 154, 154); outline: 0px; background-image: none; background-position: 0px 0px; background-repeat: repeat; background-attachment: scroll; background-color: rgb(241, 241, 241); max-width: 100%; overflow: auto; color: rgb(64, 64, 64);">docker build -t spring-boot-docker:0.0.1 .</pre><div>To analyze the image, use the dive utility. Dive allows you to show differences between layers: which files were added, changed, or removed.</div><div><br /></div><pre style="font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-stretch: normal; font-size: 12px; line-height: 18px; font-family: Consolas, Monaco, Monospaced, monospace; margin-top: 5px; margin-bottom: 5px; padding: 5px; vertical-align: baseline; border: 1px solid rgb(154, 154, 154); outline: 0px; background-image: none; background-position: 0px 0px; background-repeat: repeat; background-attachment: scroll; background-color: rgb(241, 241, 241); max-width: 100%; overflow: auto; color: rgb(64, 64, 64);">dive upagge/spring-boot-docker:dockerfile</pre><div><br /></div><div> <img style="height: auto; display: block; margin: auto; max-width: 500px;" src="/assets/images/posts/2024/00007-2.jpg" /><br /></div><div><br /></div><div>The total size of the image is 448 MB, of which:</div><div><br /></div><div> <img style="height: auto; display: block; margin: auto; max-width: 500px;" src="/assets/images/posts/2024/00007-3.jpg" /><br /></div><div><ul><li>63+8.4 MB is the Linux layer.</li><li>324 MB is the JDK size.</li><li>53 MB is our spring-boot-jar.</li></ul></div><div>Pay attention to the application layer size: 53 megabytes, even though the project contains almost no code. With any code change, we would have to send 53 megabytes over the network and the server would have to download 53 megabytes. The other layers are unlikely to change, so Docker will not transmit them over the network and will use the cache. We'll figure out how to fix this shortly.</div><div><br /></div><div>To ensure everything works, run the image with the command:</div><div><br /></div><pre style="font-variant-numeric: normal; font-variant-east-asian: normal; font-variant-alternates: normal; font-kerning: auto; font-optical-sizing: auto; font-feature-settings: normal; font-variation-settings: normal; font-variant-position: normal; font-stretch: normal; font-size: 12px; line-height: 18px; font-family: Consolas, Monaco, Monospaced, monospace; margin-top: 5px; margin-bottom: 5px; padding: 5px; vertical-align: baseline; border: 1px solid rgb(154, 154, 154); outline: 0px; background-image: none; background-position: 0px 0px; background-repeat: repeat; background-attachment: scroll; background-color: rgb(241, 241, 241); max-width: 100%; overflow: auto; color: rgb(64, 64, 64);">docker run -p 8080:8080 upagge/spring-boot-docker:0.0.1</pre><div>Open a browser and go to: http://localhost:8080/api/person/1. If the image was started successfully, you will see the word 'valid' in response.</div><div><br /></div><h3>Conclusions on Dockerfile</h3><div>This is how easily and simply we can package an application. However, this approach has several drawbacks that we will address shortly.</div><div><br /></div><div>Pros of this approach:</div><div><ul><li>Full control. You can build your image as you like.</li><li>Fairly simple method.</li></ul></div><div>Cons:</div><div><ul><li>Full control. You can break something or create a security hole.</li><li>We haven't even started development, and the image is already heavy.</li><li>A large volume of changing layers.</li><li>Runs as root user.</li></ul></div></span></div></p></div><div class="disqus-comments" id="disqus_thread"></div></div></div></section><footer id="footer"> <!--Footer Button--><div class="container has-text-centered has-background-grey-darker" id="backtotop"> <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a></div><!--Footer Main Section--><div class="has-background-grey-darker"><div class="container columns"> <!--Name Section--><div class="column has-text-left-desktop has-text-centered-mobile"> <a href="http://localhost:4000/#summary"><div class="columns"><div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet"><figure class="image is-64x64"> <img class="is-rounded" src="/assets/images/logo.png"></figure></div><div class="column is-marginless"><h5 class="has-text-grey-lighter">Roman Surkoff</h5><div class="content has-text-grey"><p>ðŸ–– Hey there! I am Roman Surkoff, an experienced software engineer</p></div></div></div></a></div><!--Link Section--><div class="column has-text-white"><h3>More Links</h3><li> <a href="http://localhost:4000/project">Projects</a></li><li> <a target="_blank" href="http://localhost:4000/feed.xml">Subscribe via RSS</a></li></div><!--Blog-post Section--><div class="column has-text-white"><h3>Recent Posts</h3><li> <a href="http://localhost:4000/blog/deploying-keycloak-to-vps">Deploying Keycloak on a VPS Using Docker-compose, Nginx, Certbot, and SSL</a></li><li> <a href="http://localhost:4000/blog/optimal-docker-image-for-springboot-4">The optimal Docker image for Spring Boot. Part 4</a></li><li> <a href="http://localhost:4000/blog/optimal-docker-image-for-springboot-3">The optimal Docker image for Spring Boot. Part 3</a></li></div></div></div><div class="has-background-black has-text-centered has-text-white" id="credits"> <i class="far fa-copyright"></i> 2019 - 2024 by <a href="mailto:surkoff.com@gmail.com" target="_blank" >Roman Surkoff</a> | Powered by <a href="https://jekyllrb.com/" target="_blank" >Jekyll</a> | Based on <a href="https://github.com/thedevslot/WhatATheme" target="_blank" rel="noopener noreferrer" >TheDevsLot's WhatATheme</a></div></footer></body><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = PAGE_URL; Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://blog-surkoff-com.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script></html>
